var SStation=function(e,t,n,i){function o(e,t){e&&e.attr(t)}function c(e,t){e=String(e).replace(/[^0-9a-f]/gi,""),e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),t=t||0;var n="#",i,o;for(o=0;3>o;o++)i=parseInt(e.substr(2*o,2),16),i=Math.round(Math.min(Math.max(0,i+i*t),255)).toString(16),n+=("00"+i).substr(i.length);return n}function r(){switch(t.type){case"bar":return{fill:c(t.color,-.25),width:config.bar_width,height:config.bar_height};break;case"end":return{fill:c(t.color,-.25),width:config.end_width,height:config.end_height};break;case"circle":return{stroke:c(t.color,-.25)}}}function l(){switch(t.type){case"bar":return{fill:config.selected_color,width:config.bar_width_selected,height:config.bar_height_selected};break;case"end":return{fill:config.selected_color,width:config.end_width_selected,height:config.end_height_selected};break;case"circle":return{stroke:config.selected_color,fill:config.selected_color,strokeWidth:config.circle_stroke_width_selected}}}function s(){switch(t.type){case"bar":return{fill:config.hover_selected_color,width:config.bar_width_selected,height:config.bar_height_selected};break;case"end":return{fill:config.hover_selected_color,width:config.end_width_selected,height:config.end_height_selected};break;case"circle":return{stroke:config.hover_selected_color,fill:config.hover_selected_color,strokeWidth:config.circle_stroke_width_selected}}}function f(){switch(t.type){case"bar":return{fill:t.color,width:config.bar_width,height:config.bar_height};break;case"end":return{fill:t.color,width:config.end_width,height:config.end_height};break;case"circle":return{stroke:t.color,fill:config.shape_idle_fill_color,strokeWidth:config.circle_stroke_width}}}function a(e,t,n){b=!0,e.attr(l()),o(t,{fill:config.selected_color}),_.selectBinded(),_.options.onSelect(_,n)}function h(e,t,n){b=!1,e.attr(f()),o(t,{fill:config.text_idle_fill_color}),_.unselectBinded(),_.options.onUnselect(_,!1)}function d(e,t){b?(e.attr(s()),t.attr({fill:config.hover_selected_color})):(e.attr(r()),o(t,{fill:config.hover_color})),_.options.onMouseOver(_)}function g(e,t){b?(e.attr(l()),t.attr({fill:config.selected_color})):(e.attr(f()),o(t,{fill:config.text_idle_fill_color})),_.options.onMouseOut(_)}function u(){v=k.getShape(),x=w.getBg(),S=w.getText(),p=e.g(v,x,S),p.hover(function(){d(v,S)},function(){g(v,S)}),_.options.on_click_enabled===!0&&p.click(function(){b?h(v,S):a(v,S),_.options.onClick(_)}),p.dblclick(function(){_.options.onDblClick(_)})}var _=this,b=!1;t.x=parseFloat(t.x),t.y=parseFloat(t.y),t.rotate=parseInt(t.rotate),t.margin=parseInt(t.margin);var k=new SShape(e,t),w=new SText(e,t,k.getShape()),p=null,v=null,S=null,x=null;this.options=$.extend({on_click_enabled:!0,onClick:function(e){},onSelect:function(e,t){},onUnselect:function(e,t){},onMouseOver:function(e){},onMouseOut:function(e){},onDblClick:function(e){}},n),this.selectBinded=function(){if(t.bind)for(var e=0;e<t.bind.length;e++){var n=t.bind[e],o=i.getStationById(n);o&&!o.isSelected()&&o.select(!0)}},this.unselectBinded=function(){if(t.bind)for(var e=0;e<t.bind.length;e++){var n=t.bind[e],o=i.getStationById(n);o&&o.isSelected()&&o.unselect(!0)}},this.select=function(e){b||a(v,S,e)},this.unselect=function(e){b&&h(v,S,e)},this.isSelected=function(){return b},this.getData=function(){return t},this.getGroup=function(){return p},this.setDataParam=function(e,n){t[e]=n},this.getDataParam=function(e){return t[e]},this.renewData=function(){w.changeText(t),v.attr(this.isSelected()?l():f()),k.rotate(t.rotate,!0,function(){w.changeText(t)})},u(),t.selected&&this.select()};