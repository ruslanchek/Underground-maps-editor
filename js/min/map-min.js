var iMap={};iMap.config={text_idle_fill_color:"rgba(120, 120, 120, 1)",text_idle_fill_hover_color:"rgba(80, 80, 80, 1)",text_selected_color:"rgba(0, 0, 0, 1)",text_selected_color_hover:"rgba(40, 40, 40, 1)",shape_idle_fill_color:"rgba(255, 255, 255, 1)",selected_color:"rgba(0, 0, 0, 0)",hover_color:"rgba(0, 0, 0, 0)",hover_selected_color:"rgba(0, 0, 0, 0)",bar_width:7,bar_height:7,bar_width_selected:7,bar_height_selected:7,end_width:21,end_height:7,end_width_selected:21,end_height_selected:7,circle_radius:7,circle_stroke_width:5,circle_stroke_width_selected:5},iMap.Map=function(t){function o(t){a.initialized=!0;var o=$("#"+a.options.target_id+", #"+a.options.target_id+"-svg");u=Snap("#"+a.options.target_id+"-svg"),Snap.load(a.options.map_svg,function(n){u.append(n),s(function(){u.zpd({zoom:!1,pan:!0,drag:!1}),i(function(){a.options.onLoad(),a.options.viewport_width&&a.options.viewport_height&&setTimeout(function(){o.animate({width:a.options.viewport_width,height:a.options.viewport_height},300,function(){setTimeout(function(){$(".map-loading-overlay").addClass("hidden"),setTimeout(function(){$(".map-loading-overlay").remove(),t&&t()},300)},300)})},700)})})})}function i(t){t&&t(),u.zoomTo(a.options.min_zoom,0,mina.easeinout,function(){},{vp_w:a.options.viewport_width,vp_h:a.options.viewport_height,c_w:a.options.map_width,c_h:a.options.map_height,offset_x:a.options.offset_x,offset_y:a.options.offset_y})}function n(t){var o=new iMap.Station(u,t,{on_click_enabled:a.options.station_on_click_enabled,onMouseOver:function(t){a.options.onStationMouseOver(t,u)},onMouseOut:function(t){a.options.onStationMouseOut(t,u)},onSelect:function(t,o){a.options.onStationSelect(t,u,o)},onUnselect:function(t,o){a.options.onStationUnselect(t,u,o)},onClick:function(t){a.options.onStationClick(t,u)},onDblClick:function(t){a.options.onStationDblClick(t,u)}},a);"end"==t.type?t.line_selector&&(o.line_end=new iMap.LineButton(u,a,t.line_selector)):o.line_end=null,c.push(o)}function e(t){var o=new iMap.LineButton(u,a,t);l.push(o)}function s(t){$.ajax({url:a.options.data_url,type:"get",dataType:"json",success:function(o){for(var i=0;i<o.stations.length;i++)n(o.stations[i]);for(var i=0;i<o.selectors.length;i++)e(o.selectors[i]);t&&t()}})}var a=this,c=[],l=[];this.options=$.extend({target_id:"",map_svg:"",data_url:"",min_zoom:.75,viewport_width:!1,viewport_height:!1,map_width:!1,map_height:!1,offset_x:!1,offset_y:!1,max_zoom:1,zoom_animation_time:300,station_on_click_enabled:!0,onLoad:function(){},onStationClick:function(t,o){},onStationMouseOver:function(t,o){},onStationMouseOut:function(t,o){},onStationSelect:function(t,o,i){},onStationUnselect:function(t,o,i){},onStationDblClick:function(t,o){}},t),this.initialized=!1,this.wrapper=!1;var r=$("#"+this.options.target_id),u=null;this.drawWraps=function(){var t="";$.browser&&!$.browser.mobile&&(t='<a href="#" class="zoomer" id="'+a.options.target_id+'-zoomer"><i class="icon-font icon-font-zoom_in"></i></a>'),r.html('<div class="map-loading-overlay"></div>'+t+'<svg id="'+a.options.target_id+'-svg"></svg>');var o=$("#"+a.options.target_id+", #"+a.options.target_id+"-svg");$.browser&&!$.browser.mobile&&$("#"+a.options.target_id+"-zoomer").on("click",function(t){t.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active"),$(this).find(".icon-font").removeClass("icon-font-zoom_out").addClass("icon-font-zoom_in"),a.zoomIn()):($(this).addClass("active"),$(this).find(".icon-font").removeClass("icon-font-zoom_in").addClass("icon-font-zoom_out"),a.zoomOut())}),a.options.viewport_width&&a.options.viewport_height&&o.css({width:a.options.viewport_width,height:100}),this.wrapper=!0},this.zoomOut=function(t){u.zoomTo(this.options.max_zoom,t?0:this.options.zoom_animation_time,mina.easeinout,function(){},{vp_w:a.options.viewport_width,vp_h:a.options.viewport_height,c_w:a.options.map_width,c_h:a.options.map_height,offset_x:a.options.offset_x,offset_y:a.options.offset_y})},this.zoomIn=function(t){u.zoomTo(this.options.min_zoom,t?0:this.options.zoom_animation_time,mina.easeinout,function(){},{vp_w:a.options.viewport_width,vp_h:a.options.viewport_height,c_w:a.options.map_width,c_h:a.options.map_height,offset_x:a.options.offset_x,offset_y:a.options.offset_y})},this.getStations=function(){return c},this.getStationById=function(t){for(var o=0;o<c.length;o++){var i=c[o];if(i.getData().id==t)return i}},this.unselectAllStations=function(){for(var t=0;t<c.length;t++)c[t].unselect()},this.iterateAllStations=function(t){for(var o=0;o<c.length;o++)t&&t(c[o])},this.getSelectedStations=function(){for(var t=[],o=0;o<c.length;o++)c[o].isSelected()===!0&&t.push(c[o]);return t},this.selectStationById=function(t){var o=this.getStationById(t);o&&o.select()},this.unselectStationById=function(t){var o=this.getStationById(t);o&&o.unselect()},this.init=function(t){o(t)},this.getSnapInstance=function(){return u}},iMap.Station=function(t,o,i,n){this.options=$.extend({on_click_enabled:!0,onClick:function(t){},onSelect:function(t,o){},onUnselect:function(t,o){},onMouseOver:function(t){},onMouseOut:function(t){},onDblClick:function(t){}},i);var e=this,s=!1,a=$("#um-station-"+o.id),c=a.children(),l=c[3],r=c[0],u=c[2];this.select=function(t){s||(s=!0,$(l).css({opacity:1}),$(r).css({opacity:0}),$(u).attr("fill",iMap.config.text_selected_color),e.selectBinded(),e.options.onSelect(e,t))},this.unselect=function(t){s&&(s=!1,$(l).css({opacity:0}),$(r).css({opacity:1}),$(u).attr("fill",iMap.config.text_idle_fill_color),e.unselectBinded(),e.options.onUnselect(e,!1))},this.isSelected=function(){return s},this.getData=function(){return o},this.toggle=function(){s?this.unselect():this.select()},this.selectBinded=function(){if(o.bind)for(var t=0;t<o.bind.length;t++){var i=o.bind[t],e=n.getStationById(i);e&&!e.isSelected()&&e.select(!0)}},this.unselectBinded=function(){if(o.bind)for(var t=0;t<o.bind.length;t++){var i=o.bind[t],e=n.getStationById(i);e&&e.isSelected()&&e.unselect(!0)}},this.getGroup=function(){return group},this.setDataParam=function(t,i){o[t]=i},this.getDataParam=function(t){return o[t]},this.renewData=function(){},a.on("click",function(t){t.preventDefault(),e.options.onClick(e),e.toggle()}),a.on("bblClick",function(t){t.preventDefault(),e.options.onDblClick(e)}),a.on("mouseover",function(){e.options.onMouseOver(e)}),a.on("mouseout",function(){e.options.onMouseOut(e)})},iMap.LineButton=function(t,o,i){var n=this,e=$("#um-select-line-"+i.id);this.toggle=function(){if(i.select){for(var t=[],n=[],e=0,s=i.select.length;s>e;e++){var a=o.getStationById(i.select[e]);a&&(a.isSelected()?t.push(i.select[e]):n.push(i.select[e]))}if(i.select.length==t.length)for(var e=0,s=i.select.length;s>e;e++){var a=o.getStationById(i.select[e]);a&&a.unselect()}else for(var e=0,s=i.select.length;s>e;e++){var a=o.getStationById(i.select[e]);a&&a.select()}}},e.on("click",function(t){console.log(i.select),n.toggle(),t.preventDefault()})};