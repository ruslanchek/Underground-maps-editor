var iMap={};iMap.config={text_idle_fill_color:"rgba(120, 120, 120, 1)",text_idle_fill_hover_color:"rgba(80, 80, 80, 1)",text_selected_color:"rgba(0, 0, 0, 1)",text_selected_color_hover:"rgba(40, 40, 40, 1)",shape_idle_fill_color:"rgba(255, 255, 255, 1)",selected_color:"rgba(0, 0, 0, 0)",hover_color:"rgba(0, 0, 0, 0)",hover_selected_color:"rgba(0, 0, 0, 0)",bar_width:7,bar_height:7,bar_width_selected:7,bar_height_selected:7,end_width:21,end_height:7,end_width_selected:21,end_height_selected:7,circle_radius:7,circle_stroke_width:5,circle_stroke_width_selected:5},iMap.Map=function(t){function o(t){a.initialized=!0;var o=$("#"+a.options.target_id+", #"+a.options.target_id+"-svg");l=Snap("#"+a.options.target_id+"-svg"),Snap.load(a.options.map_svg,function(n){l.append(n),s(function(){l.zpd({zoom:!1,pan:!0,drag:!1}),i(function(){a.options.onLoad(),a.options.viewport_width&&a.options.viewport_height&&setTimeout(function(){o.animate({width:a.options.viewport_width,height:a.options.viewport_height},300,function(){setTimeout(function(){$(".map-loading-overlay").addClass("hidden"),setTimeout(function(){$(".map-loading-overlay").remove(),t&&t()},300)},300)})},700)})})})}function i(t){t&&t(),l.zoomTo(a.options.min_zoom,0,mina.easeinout,function(){},{vp_w:a.options.viewport_width,vp_h:a.options.viewport_height,c_w:a.options.map_width,c_h:a.options.map_height,offset_x:a.options.offset_x,offset_y:a.options.offset_y})}function n(t){var o=new iMap.Station(l,t,{on_click_enabled:a.options.station_on_click_enabled,onMouseOver:function(t){a.options.onStationMouseOver(t,l)},onMouseOut:function(t){a.options.onStationMouseOut(t,l)},onSelect:function(t,o){a.options.onStationSelect(t,l,o)},onUnselect:function(t,o){a.options.onStationUnselect(t,l,o)},onClick:function(t){a.options.onStationClick(t,l)},onDblClick:function(t){a.options.onStationDblClick(t,l)}},a);"end"==t.type?t.line_selector&&(o.line_end=new iMap.LineButton(l,a,t.line_selector)):o.line_end=null,c.push(o)}function e(t){var o=new iMap.LineButton(l,a,t);r.push(o)}function s(t){$.ajax({url:a.options.data_url,type:"get",dataType:"json",success:function(o){for(var i=0;i<o.stations.length;i++)n(o.stations[i]);for(var i=0;i<o.selectors.length;i++)e(o.selectors[i]);t&&t()}})}var a=this,c=[],r=[];this.options=$.extend({target_id:"",map_svg:"",data_url:"",min_zoom:.75,viewport_width:!1,viewport_height:!1,map_width:!1,map_height:!1,offset_x:!1,offset_y:!1,max_zoom:1,zoom_animation_time:300,station_on_click_enabled:!0,onLoad:function(){},onStationClick:function(t,o){},onStationMouseOver:function(t,o){},onStationMouseOut:function(t,o){},onStationSelect:function(t,o,i){},onStationUnselect:function(t,o,i){},onStationDblClick:function(t,o){}},t),this.initialized=!1,this.wrapper=!1;var _=$("#"+this.options.target_id),l=null;this.drawWraps=function(){var t="";$.browser&&!$.browser.mobile&&(t='<a href="#" class="zoomer" id="'+a.options.target_id+'-zoomer"><i class="icon-font icon-font-zoom_in"></i></a>'),_.html('<div class="map-loading-overlay"></div>'+t+'<svg id="'+a.options.target_id+'-svg"></svg>');var o=$("#"+a.options.target_id+", #"+a.options.target_id+"-svg");$.browser&&!$.browser.mobile&&$("#"+a.options.target_id+"-zoomer").on("click",function(t){t.preventDefault(),$(this).hasClass("active")?($(this).removeClass("active"),$(this).find(".icon-font").removeClass("icon-font-zoom_out").addClass("icon-font-zoom_in"),a.zoomIn()):($(this).addClass("active"),$(this).find(".icon-font").removeClass("icon-font-zoom_in").addClass("icon-font-zoom_out"),a.zoomOut())}),a.options.viewport_width&&a.options.viewport_height&&o.css({width:a.options.viewport_width,height:100}),this.wrapper=!0},this.zoomOut=function(t){l.zoomTo(this.options.max_zoom,t?0:this.options.zoom_animation_time,mina.easeinout,function(){},{vp_w:a.options.viewport_width,vp_h:a.options.viewport_height,c_w:a.options.map_width,c_h:a.options.map_height,offset_x:a.options.offset_x,offset_y:a.options.offset_y})},this.zoomIn=function(t){l.zoomTo(this.options.min_zoom,t?0:this.options.zoom_animation_time,mina.easeinout,function(){},{vp_w:a.options.viewport_width,vp_h:a.options.viewport_height,c_w:a.options.map_width,c_h:a.options.map_height,offset_x:a.options.offset_x,offset_y:a.options.offset_y})},this.getStations=function(){return c},this.getStationById=function(t){for(var o=0;o<c.length;o++){var i=c[o];if(i.getData().id==t)return i}},this.unselectAllStations=function(){for(var t=0;t<c.length;t++)c[t].unselect()},this.iterateAllStations=function(t){for(var o=0;o<c.length;o++)t&&t(c[o])},this.getSelectedStations=function(){for(var t=[],o=0;o<c.length;o++)c[o].isSelected()===!0&&t.push(c[o]);return t},this.selectStationById=function(t){var o=this.getStationById(t);o&&o.select()},this.unselectStationById=function(t){var o=this.getStationById(t);o&&o.unselect()},this.init=function(t){o(t)},this.getSnapInstance=function(){return l}},iMap.Station=function(t,o,i,n){var e=this,s=!1,a=$("#um-station-"+o.id),c=a.children(),r=c[3],_=c[0],l=c[2];this.select=function(){s=!0,$(r).css({opacity:1}),$(_).css({opacity:0}),$(l).attr("fill",iMap.config.text_selected_color)},this.unselect=function(){s=!1,$(r).css({opacity:0}),$(_).css({opacity:1}),$(l).attr("fill",iMap.config.text_idle_fill_color)},this.isSelected=function(){return s},this.getData=function(){return o},this.getDataParam=function(t){return o[t]},this.trigger=function(){s?this.unselect():this.select()},a.on("click",function(t){t.preventDefault(),e.trigger()})},iMap.LineButton=function(t,o,i){};