iMap.Station.prototype.deleteStation=function(){confirm("Are you sure to delete?")&&(m.unsetCurrentStation(),$("#edit").hide(),$("#add").show(),this.getGroup().remove(),this.getData()["delete"]=!0)},iMap.Station.prototype.enableEdit=function(t){function a(t){console.station,t.setDataParam("name",$("#seditor-name").val()),t.setDataParam("color",$("#seditor-color").val()),t.setDataParam("margin",parseInt($("#seditor-margin").val())),t.setDataParam("text_side",$("#seditor-text_side").val()),t.setDataParam("rotate",parseInt($("#seditor-rotate").val())),t.setDataParam("id",$("#seditor-id").val()),t.setDataParam("pid",$("#seditor-pid").val()),t.setDataParam("changed",!0),t.renewData()}function e(t){t.setDataParam("x",i.x),t.setDataParam("y",i.y),t.setDataParam("name",i.name),t.setDataParam("color",i.color),t.setDataParam("margin",i.margin),t.setDataParam("text_side",i.text_side),t.setDataParam("rotate",i.rotate),t.setDataParam("changed",!1),t.renewData()}function o(o){$("#edit").show(),$("#add").hide(),$("#seditor-color-preview").css({backgroundColor:o.getDataParam("color")}),$("#seditor-id").val(o.getDataParam("id")),$("#seditor-pid").val(o.getDataParam("pid")),$("#seditor-name").val(o.getDataParam("name")).off("keyup").on("keyup",function(){o.setDataParam("name",$(this).val()),console.log(o),o.renewData()}),$("#seditor-color").val(o.getDataParam("color")).off("keyup").on("keyup",function(){o.setDataParam("color",$(this).val()),$("#seditor-color-preview").css({backgroundColor:o.getDataParam("color")}),o.renewData()}),$("#seditor-margin").val(o.getDataParam("margin")).off("keyup").on("keyup",function(){o.setDataParam("margin",$(this).val()),o.renewData()}),$("#seditor-rotate").val(o.getDataParam("rotate")).off("keyup").on("keyup",function(){o.setDataParam("rotate",$(this).val()),o.renewData()}),$("#seditor-text_side").find('option[value="'+o.getDataParam("text_side")+'"]').attr("selected","selected"),$("#seditor-text_side").off("select change").on("select change",function(){o.setDataParam("text_side",$(this).val()),o.renewData()}),$("#seditor-edit-close").off("click").on("click",function(a){a.preventDefault(),e(o),o.disableEdit(t)}),$("#seditor-delete").off("click").on("click",function(a){a.preventDefault(),o.deleteStation(),o.disableEdit(t)}),$("#seditor-submit").off("click").on("click",function(e){e.preventDefault(),a(o),o.disableEdit(t)})}function r(t,a){this.ox=t-this.cx,this.oy=a-this.cy}function n(t,a,e,o){s.cx=e-s.ox,s.cy=o-s.oy;var r="t"+s.cx+","+s.cy;s.transform(r),d.setDataParam("x",i.x+s.cx),d.setDataParam("y",i.y+s.cy),console.log(d.getDataParam("x"),d.getDataParam("y"))}m.setCurrentStation(this);var i=$.extend({},this.getData());o(this),t.zpd({zoom:!1,pan:!1,drag:!1}),this.select();var s=this.getGroup(),d=this;s.cx=0,s.cy=0,s.ox=0,s.oy=0,s.drag(n,r,function(t){}),$("body").off("keydown.moveStation").off("keyup.moveStation").on("keydown.moveStation",function(t){return $.inArray(t.keyCode,[37,38,39,40])>=0?(t.preventDefault(),!1):void 0}).on("keyup.moveStation",function(o){var i=0,c=0,l=1;switch(o.shiftKey&&!o.altKey&&(l=10),o.altKey&&!o.shiftKey&&(l=.5),o.keyCode){case 38:c-=l;break;case 39:i+=l;break;case 40:c+=l;break;case 37:i-=l;break;case 13:a(),d.disableEdit(t);break;case 27:d.disableEdit(t),e()}return i+=s.cx,c+=s.cy,r(i,c),n(0,0,i,c),$.inArray(o.keyCode,[37,38,39,40])>=0?(o.preventDefault(),!1):void 0})},iMap.Station.prototype.disableEdit=function(t){m.unsetCurrentStation(),$("body").off("keydown.moveStation").off("keyup.moveStation"),t.zpd({zoom:!1,pan:!0,drag:!1}),this.unselect();var a=this.getGroup();a.drag(!1,!1,!1),$("#edit").hide(),$("#add").show()},iMap.Map.prototype.setStationsOffset=function(t,a){for(var e=this.getStations(),o=0;o<e.length;o++){var r=e[o];r.setDataParam("x",r.getDataParam("x")+t),r.setDataParam("y",r.getDataParam("y")+a),r.setDataParam("changed",!0),r.renewData()}},iMap.Map.prototype.setCurrentStation=function(t){this.current_station=t},iMap.Map.prototype.unsetCurrentStation=function(){this.current_station=null},iMap.Map.prototype.getCurrentStation=function(){return this.current_station},iMap.Map.prototype.getStationsData=function(){for(var t=this.getStations(),a=[],e=0;e<t.length;e++){var o=t[e],r=o.getData();delete r.changed,delete r["new"],r["delete"]!==!0&&a.push(r)}return a},iMap.Map.prototype.getChangedStations=function(){for(var t=this.getStations(),a=[],e=0;e<t.length;e++){var o=t[e],r=o.getData();r.changed===!0&&r["delete"]!==!0&&a.push(o)}return a},iMap.Map.prototype.getChangedStationsData=function(){for(var t=this.getChangedStations(),a=[],e=0;e<t.length;e++){var o=t[e],r=o.getData();delete r.changed,delete r["new"],r["delete"]!==!0&&a.push()}return a},iMap.Map.prototype.generateId=function(){function t(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}var a=t();return this.getStationById(a)?this.generateId():a},iMap.Map.prototype.generateStationsSVG=function(){for(var t=this.getStations(),a='<g x="0" y="0">',e=0;e<t.length;e++){var o=t[e];a+=o.extractSVG()}return a+="</g>"};